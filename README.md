# yunusovtr_microservices
yunusovtr microservices repository

## Домашняя работа №16: Технология контейнеризации. Введение в Docker

### Что сделано
 - Пройдена методичка
 - Добавил вывод команды docker images в файл docker-monolith/docker-1.log
 - Задание со *. Внёс ответ в файл: "Выводы в чём-то схожи. У контейнера данных больше и выглядят как данные образа дополненные данными конкретного окружения, описаниями драйверов и интерфейсов."
 - Прошёл методичку до конца. Задание со * в конце делать не стал.

## Домашняя работа №17: Docker-образы. Микросервисы
 - Выполнил методичку, запустил четыре контейнера, проверил работу приложения
 - Задание со *. Запуск приложения с другими сетевыми алиасами и адаптация под них переменных окружения:
   - docker run -d --network=reddit --network-alias=OTHER_post_db --network-alias=OTHER_comment_db mongo:4.2.18
   - docker run -d --network=reddit --network-alias=OTHER_post --env POST_DATABASE_HOST=OTHER_post_db yunusovtr/post:1.0
   - docker run -d --network=reddit --network-alias=OTHER_comment --env COMMENT_DATABASE_HOST=OTHER_comment_db yunusovtr/comment:1.0
   - docker run -d --network=reddit -p 9292:9292 --env POST_SERVICE_HOST=OTHER_post --env COMMENT_SERVICE_HOST=OTHER_comment yunusovtr/ui:1.0
 - Выполнил до конца методички: собрал новую версию образа ui и создал том для mongodb, проверил работу

## Домашняя работа №18: Docker: сети, docker-compose
 - Поэкспериментировал с сетями внутри докера, повторил запуски контейнеров с использованием драйверов
none и host и посмотрел, как меняется список namespace-ов, подключал контейнеры одновременно к двум бриджам, увидел как создаются интерфейсы и правила iptables для работы докера.
 - Установил docker-compose, попробовал.
 - Переделал docker-compose.yml в соответствии с заданием, параметризировал порт публикации ui сервиса, версии каждого сервиса, версию mongo
 - Отвечаю на вопрос. Имя для проекта можно задать, переименовав каталог с файлом docker-compose.yml, либо при запуске и остановке сервисов указывать ключ -p или --project-name, например: docker-compose -p newname up -d И docker-compose -p newname down

## Домашняя работа №22: Введение в мониторинг. Системы мониторинга.
 - Запустил Prometheus в докере совместно с другими сервисами приложения.
 - Самостоятельно восстановил работу comment. Мониторинг показал его неработоспособность - оказалось с предыдущего ДЗ неверно был указан хост с БД. Это тоже показал мониторинг недоступностью БД.
 - Задание со *. Добавил экспортёр для mongoDB в виде докер контейнера на образ percona/mongodb_exporter:0.30. Соответственно обновил конфигурационный файл prometheus.yml
 - Задание со *. Добавил blackbox экспортёр в виде докер контейнера на образ prom/blackbox-exporter-linux-amd64:latest. Добавил мониторинг фронта http://ui:9292. Соответственно обновил конфигурационный файл prometheus.yml

## Домашняя работа №25: Логирование и распределенная трассировка
 - Пересобрал образы под тег logging через новые скрипты по методичке
 - Собрал конфигурацию docker-compose-logging, запустил параллельно с контейнерами приложения
 - Поэкспериментировал со структурированными логами и их визуализацией в Kibana
 - Подключил сервис ui к логированию, настроил по методичке и советам сокурсников шаблон grok
 - Задание со *: настроил второй шаблон grok для распарса логов другой структуры
 - Добавил Zipkin, посмотрел на трейсинг - полезная вещь

## Домашняя работа №27: Введение в Kubernetes
 - Создал виртуальные машины
 - Установил кубер на них
 - Одну машину сделал мастером кластера, вторую слейвом
 - Установил сетевой плагин
 - Испытал запуск подов
 - Задание с **: Описал запуск кластера в Yandex Cloud, используя terraform и ansible

## Домашняя работа №28: Kubernetes. Запуск кластера и приложения. Модель безопасности
 - Установил локально kubectl и minikube
 - Через minikube развернул кластер на локальной машине, используя драйвер VirtualBox
 - Развернул по методичке компоненты ui и comment
 - По аналогии развернул компонент post самостоятельно и проверил его работу
 - Добавил mongoDB
 - Настроил доступность mongodb через сервисы по методичке
 - Настроил, запустил, посмотрел dashboard
 - Добавил окружение dev и запустил там копии сервисов приложения reddit
 - Создал кластер в облаке Яндекс
 - Сдеплоил в облако приложение, проверил работоспособность

## Домашняя работа №30: Kubernetes. Networks. Storages
 - Восстановил кластер kubernetes в yandex cloud и развернул reddit приложение
 - Настроил LoadBalancer по инструкции
 - Настроил Ingress c https
 - * Написал манифест для секрета tls, разместил в kubernetes/reddit/tlssecret.yml
 - Настроил NetworkPolicy
 - Настроил PersistentVolume, PersistentVolumeClaim, прикрепил к деплою mongo, поэкспериментировал

## Домашняя работа №32: CI/CD в Kubernetes
 - Установил helm 2 и tiller в предварительно развёрнутый кластер kubernetes в Yandex.Cloud
 - Создал чарты для компонентов приложения
 - Выполнил задание, создав в каждом из каталогов templates по файлу _helpers.tpl, в котором создал функции post.fullname, ui.fullname
 - Собрал все чарты под одним чартом reddit, добавил рабочий mongodb
 - Добавил переменные окружения для связи компонентов друг с другом и отключил авторизацию у mongodb, из-за чего не стартовал post. Всё заработало
 - Gitlab в рекомендуемой методичкой depricated omnibus версии отказался вставать вероятно из-за того, что я использовал kubernetes версии 1.21. Поэтому я зарегистрировал бесплатный домен третьего уровня и установил gitlab через helm командой
 helm install gitlab gitlab/gitlab --set global.hosts.domain=yunusovtr.my.to --set certmanager-issuer.email=yunusovtr@live.ru --set gitlab-runner.runners.privileged=true
 - Создал репозитории comment, post, ui, reddit-deploy в соответствии с методичкой.
 - Создал CI, но для его запуска пришлось отлаживать код: helm 2 не качался из прежнего расположения, был захардкодена ссылка к гитлабу, не работал с kubernetes: active и подключаться к кластеру без гитлаб агента и переключения контекста внутри раннера он тоже отказывался. Соответственно установил и настроил гитлаб агент для каждого из репозиториев.
 - Отладил код и для reddit-deploy. Убедился что все пайплайны успешно отрабатывают.
 - Код CI компонента comment не менял на использование tiller plugin - разрешение на это получено в Slack
 - Изменил код CI у компонента post на использование Helm 3
 - Отредактировал код CI у reddit-deploy под читабельный вид.
 - Задание со *. Организовал мультипроджект пайплайн путём добавления джобы с триггером и дополнительным условием запуска в джобе production
